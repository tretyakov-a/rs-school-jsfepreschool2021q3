(()=>{var __webpack_modules__={928:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="game__top-panel">\n  <div class="game__timer">\n    <span class="game__panel-icon">\n      <i class="far fa-clock"></i>\n    </span>\n    <span class="game__timer-value">000</span>\n  </div>\n  <div class="game__indicator">\n    <button class="reset-btn button">\n    </button>\n  </div>\n  <div class="game__flags-counter">\n    <span class="game__flags-counter-value">000</span>\n    <span class="game__panel-icon game__panel-icon_flag">\n    </span>\n  </div>\n</div>');return __output}},232:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="modal__content-row">\n  <span class="modal__content-title">Difficulty:</span>\n  <span class="modal__content-data">'),__append(escapeFn(locals.difficulty)),__append('</span>\n</div>\n\n<div class="modal__content-row">\n  <span class="modal__content-title">Time:</span>\n  <span class="modal__content-data">'),__append(escapeFn(locals.time)),__append("</span>\n</div>\n\n"),locals.isNewBestTime&&(__append('\n  <div class="modal__congratulation">\n    Congratulations! Its new best time on '),__append(escapeFn(locals.difficulty)),__append(" difficulty!\n    "),0!==locals.oldBestTime&&(__append("\n    Old one is "),__append(escapeFn(locals.oldBestTime)),__append(".\n    ")),__append("\n  </div>\n"));return __output}},765:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('\n<div class="statistics">\n  '),locals.blocks.length>0?(__append('\n    <h3 class="statistics__subtitle">Difficulty:\n      '),locals.blocks.forEach((function(block){__append("\n        "),__append(__webpack_require__(22)(block)),__append("\n      ")})),__append("\n    </h3>\n  ")):__append("\n  <p>There are no played games yet</p>\n  "),__append("\n  "),locals.blocks.forEach((function(block){__append("\n    "),__append(__webpack_require__(527)(block)),__append("\n  ")})),__append("\n</div>\n\n");return __output}},22:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<button\n  class="statistics__button '),locals.active&&__append("statistics__button_active"),__append(' button"\n  data-block-name="'),__append(escapeFn(locals.difficulty)),__append('">\n  '),__append(escapeFn(locals.difficulty)),__append("\n</button>");return __output}},527:module=>{module.exports=function anonymous(locals,escapeFn,include,rethrow){escapeFn=escapeFn||function(markup){return null==markup?"":String(markup).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(c){return _ENCODE_HTML_RULES[c]||c}var __output="";function __append(s){null!=s&&(__output+=s)}with(locals||{})__append('<div class="statistics__block '),locals.active&&__append("statistics__block_active"),__append('" data-name="'),__append(escapeFn(locals.difficulty)),__append('">\n  <div class="statistics__row">\n    <span class="statistics__row-title">Total games:</span>\n    <span class="statistics__row-data">'),__append(escapeFn(locals.gamesNumber)),__append('</span>\n  </div>\n  <div class="statistics__row">\n    <span class="statistics__row-title">Wins:</span>\n    <span class="statistics__row-data">'),__append(escapeFn(locals.wins)),__append('</span>\n  </div>\n  <div class="statistics__row">\n    <span class="statistics__row-title">Loses:</span>\n    <span class="statistics__row-data">'),__append(escapeFn(locals.loses)),__append('</span>\n  </div>\n  <div class="statistics__row">\n    <span class="statistics__row-title">Best time:</span>\n    <span class="statistics__row-data">'),__append(escapeFn(locals.bestTime)),__append('</span>\n  </div>\n  <div class="statistics__row statistics__row_column">\n    <div class="statistics__row-title">Last games:</div>\n    <table class="statistics__games">\n      <tr>\n        <th>Result</th>\n        <th>Time</th>\n        <th>Date</th>\n      </tr>\n      '),locals.games.forEach((function(game,i){__append('\n        <tr class="statistics__games-item">\n          <td class="'),"win"===game.result?__append("statistics__games-result_win"):__append("statistics__games-result_lose"),__append('">'),__append(escapeFn(game.result)),__append("</td>\n          <td>"),__append(escapeFn(game.time)),__append("</td>\n          <td>"),__append(escapeFn(game.date)),__append("</td>  \n        </tr>\n      ")})),__append("\n    </table>\n  </div>\n</div>");return __output}},183:module=>{"use strict";module.exports="## Требования (70/60)\n1. Вёрстка (10/10)\n   - реализован интерфейс игры (5/5)\n   - в футере приложения есть ссылка на гитхаб автора приложения, год создания приложения, [логотип курса](https://rs.school/images/rs_school_js.svg) со [ссылкой на курс](https://rs.school/js-stage0/) (5/5)\n2. Логика игры. Ходы, перемещения фигур, другие действия игрока подчиняются определённым свойственным игре правилам (10/10)\n3. Реализовано завершение игры при достижении игровой цели (10/10)\n4. По окончанию игры выводится её результат, например, количество ходов, время игры, набранные баллы, выигрыш или поражение и т.д (10/10) \n5. Результаты последних 10 игр сохраняются в local storage. Есть таблица рекордов, в которой сохраняются результаты предыдущих 10 игр (10/10)\n6. Анимации или звуки, или настройки игры. Баллы начисляются за любой из перечисленных пунктов (10/10)\n7. Очень высокое качество оформления приложения и/или дополнительный не предусмотренный в задании функционал, улучшающий качество приложения (10/10)\n   - высокое качество оформления приложения предполагает собственное оригинальное оформление равное или отличающееся в лучшую сторону по сравнению с демо"}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop);var __webpack_exports__={};(()=>{"use strict";var requirements=__webpack_require__(183);const options={difficulty:{easy:{mines:10,width:9,height:9},medium:{mines:40,width:16,height:16},expert:{mines:99,width:30,height:16}}},CELL_CLASS="game-field__cell",setModificator=name=>`${CELL_CLASS}_${name}`,CELL_MODIFICATORS={closed:setModificator("closed"),flagged:setModificator("flagged"),wronglyFlagged:setModificator("wrongly-flagged"),empty:setModificator("empty"),mine:setModificator("mine"),mineBlowned:setModificator("mine-blowned"),number:setModificator("number-"),highlighted:setModificator("highlighted")},MOUSE_LEFT=0,MOUSE_RIGHT=2;function randomNumber(min,max){return Math.floor(Math.random()*(max-min)+min)}function renderNumber(n,len=3){const s=n.toString();return s.length<len?"0".repeat(len-s.length)+s:s}function isClickOutside(e,classNames){return classNames.every((className=>!e.path.find((el=>el.classList&&el.classList.contains(className)))))}function renderTime(timeMs){const ms=renderNumber(timeMs%1e3,3);return`${renderNumber(Math.floor(timeMs/1e3),1)}.${ms} sec`}class Emitter{constructor(){this.listeners={}}emit(eventName,...args){return!!Array.isArray(this.listeners[eventName])&&(this.listeners[eventName].forEach((listener=>{listener(...args)})),!0)}subscribe(eventName,fn){return this.listeners[eventName]||(this.listeners[eventName]=[]),this.listeners[eventName].push(fn),()=>{this.listeners[eventName]=this.listeners[eventName].filter((listener=>listener!==fn))}}}class Cell extends Emitter{constructor(key){super(),this.state=Cell.STATE_CLOSED,this.value=Cell.VALUE_EMPTY,this.key=key}getKey(){return this.key.value}get state(){return this._state}set state(newState){newState===Cell.STATE_OPENED&&(this.value===Cell.VALUE_MINE&&this.emit("mineopen",this),this.emit("cellopen",this)),this._state=newState}get value(){return this._value}set value(newValue){this._value=newValue}get isOpened(){return this._state===Cell.STATE_OPENED}get isClosed(){return this._state===Cell.STATE_CLOSED}get isFlagged(){return this._state===Cell.STATE_FLAGGED}get isNumber(){return Cell.isNumberValue(this._value)}get isEmpty(){return this._value===Cell.VALUE_EMPTY}get isMined(){return this._value===Cell.VALUE_MINE}}Cell.isNumberValue=value=>value>0&&value<=8,Cell.STATE_CLOSED=0,Cell.STATE_OPENED=1,Cell.STATE_FLAGGED=2,Cell.VALUE_EMPTY=0,Cell.VALUE_MINE=9,Cell.VALUE_N_1=1,Cell.VALUE_N_2=2,Cell.VALUE_N_3=3,Cell.VALUE_N_4=4,Cell.VALUE_N_5=5,Cell.VALUE_N_6=6,Cell.VALUE_N_7=7,Cell.VALUE_N_8=8;class CellKey{constructor(x,y){"number"==typeof x&&"number"==typeof y?(this.x=x,this.y=y):"string"==typeof x&&void 0===y&&(this.value=x)}get x(){return this._x}set x(newX){this._x=Number(newX)}get y(){return this._y}set y(newY){this._y=Number(newY)}get value(){return`${this.x}-${this.y}`}set value(newValue){const[x,y]=newValue.split("-");this.x=x,this.y=y}toString(){return this.value}valueOf(){return this.value}}const checks={topLeft:[-1,-1],top:[-1,0],topRight:[-1,1],left:[0,-1],right:[0,1],bottomLeft:[1,-1],bottom:[1,0],bottomRight:[1,1]};var game_top_panel=__webpack_require__(928),game_top_panel_default=__webpack_require__.n(game_top_panel);const settings=document.querySelector('[data-tab="settings"]'),difficultySelect=settings.querySelector('select[name="difficulty"]'),selectOptions=settings.querySelector(".custom-select__options"),themeCheckbox=settings.querySelector('input[name="dark-theme"]'),defaultSettings={theme:"light",difficulty:"easy"};let currentSettings=function loadFromLocalStorage(){const settings=localStorage.getItem("settings");return settings?JSON.parse(settings):defaultSettings}(),resetGame=null;function handleSettingsChange(e){switch(e.target.name){case"difficulty":!function handleDifficultyChange(e){if(currentSettings.difficulty===e.target.value)return;currentSettings.difficulty=e.target.value,saveToLocalStorage(),resetGame(e,e.target.value)}(e);break;case"dark-theme":setTheme(e.target.checked?"dark":"light")}}function setTheme(theme){currentSettings.theme=theme,saveToLocalStorage(),"dark"===theme?document.body.classList.add("theme-dark"):document.body.classList.remove("theme-dark")}function saveToLocalStorage(){localStorage.setItem("settings",JSON.stringify(currentSettings))}function handleDifficultySelectClick(e){selectOptions.classList.toggle("custom-select__options_show")}function handleDifficultySelectOptionsClick(e){setActiveOption(e?e.target.dataset.value:currentSettings.difficulty),difficultySelect.dispatchEvent(new Event("change")),selectOptions.classList.remove("custom-select__options_show")}function setActiveOption(difficulty){difficultySelect.value=difficulty;const options=selectOptions.querySelectorAll(".custom-select__options-item");for(const option of options)option.classList.remove("custom-select__options-item_active"),option.dataset.value===difficulty&&option.classList.add("custom-select__options-item_active")}function handleSettingsClick(e){isClickOutside(e,["custom-select"])&&selectOptions.classList.remove("custom-select__options_show")}var statistics=__webpack_require__(765),statistics_default=__webpack_require__.n(statistics);const statisticsTab=document.querySelector('[data-tab="statistics"'),statistics_statistics=function statistics_loadFromLocalStorage(){const stats=localStorage.getItem("statistics");if(stats)return JSON.parse(stats);return{}}();function updateStatistics({difficulty,result,time}){void 0===statistics_statistics[difficulty]&&(statistics_statistics[difficulty]=[]),statistics_statistics[difficulty].push({date:Date.now(),result,time}),localStorage.setItem("statistics",JSON.stringify(statistics_statistics))}function findMinTime(difficulty){const games=statistics_statistics[difficulty];if(!games)return 1/0;const wins=games.filter((game=>"win"===game.result));return wins.length>0?wins.reduce(((min,game)=>min>game.time?game.time:min),wins[0].time):1/0}function toConverted({date,time,result}){return{date:new Date(date).toLocaleString(),time:renderTime(time),result}}function getStatisticsData(difficulty){const games=statistics_statistics[difficulty];if(0===games.length)return null;const wins=games.filter((game=>"win"===game.result)),minTime=findMinTime(difficulty);return{difficulty,games:games.slice(-10).map(toConverted).reverse(),active:"easy"===difficulty?"statistics__block_show":"",gamesNumber:games.length,wins:wins.length,loses:games.length-wins.length,bestTime:minTime!==1/0?renderTime(minTime):"No wins yet"}}function renderStatistics(){const blocks=Object.keys(statistics_statistics).map(getStatisticsData).filter((el=>null!==el));return statistics_default()({blocks})}function handleStatisticsTabClick(e){const btn=e.target.closest("[data-block-name]");btn&&function switchTab(btn){const btns=statisticsTab.querySelectorAll("[data-block-name]");for(const btn of btns)btn.classList.remove("statistics__button_active");btn.classList.add("statistics__button_active");const blocks=statisticsTab.querySelectorAll("[data-name]");for(const block of blocks)block.classList.remove("statistics__block_active"),block.dataset.name===btn.dataset.blockName&&block.classList.add("statistics__block_active")}(btn)}const tabs=document.querySelectorAll("[data-tab]"),header=document.querySelector(".header");function handleMenuBtnClick(e){const btn=e.target.closest(".button");btn&&btn.dataset.tabLink&&showTab(btn.dataset.tabLink)}function showTab(tabName=""){""!==tabName&&header.classList.add("header_show");for(const tab of tabs)if(tab.classList.remove("menu-tabs__item_show"),tab.dataset.tab===tabName){if("statistics"===tabName){const html=renderStatistics();tab.querySelector(".menu-tabs__content").innerHTML=html}tab.classList.add("menu-tabs__item_show")}setTimeout((()=>{document.addEventListener("click",handleDocumentClick)}))}function handleDocumentClick(e){(isClickOutside(e,["header"])||e.target.closest(".menu-tabs__close-btn"))&&function hideTabs(){header.classList.replace("header_show","header_hide"),setTimeout((()=>{header.classList.remove("header_hide"),showTab()}),400),document.removeEventListener("click",handleDocumentClick)}()}var modal_content=__webpack_require__(232),modal_content_default=__webpack_require__.n(modal_content);const modal=document.querySelector(".game__modal"),title=modal.querySelector(".modal__title"),content=modal.querySelector(".modal__content");function showModal({difficulty,result,time}){const isWin="win"===result;title.textContent=isWin?"You won!":"You lost!",content.innerHTML=function renderContent(isWin,difficulty,time){const oldBestTime=findMinTime(difficulty),isNewBestTime=isWin&&oldBestTime>time;return modal_content_default()({isNewBestTime,oldBestTime:oldBestTime!==1/0?renderTime(oldBestTime):0,difficulty,time:renderTime(time)})}(isWin,difficulty,time);const resultModificator=isWin?"modal_win":"modal_lose";modal.classList.remove("modal_win","modal_lose"),modal.classList.add("modal_show",resultModificator),setTimeout((()=>{document.addEventListener("click",modal_handleDocumentClick)}))}function modal_handleDocumentClick(e){(isClickOutside(e,["game__modal"])||e.target.closest(".modal__close-btn"))&&function hideModal(){modal.classList.remove("modal_show"),modal.classList.add("modal_hide"),document.removeEventListener("click",modal_handleDocumentClick),setTimeout((()=>{modal.classList.remove("modal_hide")}),400)}()}let{difficulty:currentDifficulty}=function init(onDifficultyChange){return resetGame=onDifficultyChange,themeCheckbox.addEventListener("change",handleSettingsChange),settings.addEventListener("click",handleSettingsClick),difficultySelect.addEventListener("change",handleSettingsChange),difficultySelect.addEventListener("mousedown",(e=>e.preventDefault())),difficultySelect.addEventListener("click",handleDifficultySelectClick),selectOptions.addEventListener("click",handleDifficultySelectOptionsClick),setActiveOption(currentSettings.difficulty),setTheme(currentSettings.theme),themeCheckbox.checked="dark"===currentSettings.theme,currentSettings}(index_resetGame);const gameState=new class GameState extends Emitter{constructor(difficulty,onWin,onLose){super(),this.difficulty=difficulty,this.onWin=onWin,this.onLose=onLose,this.isGameRunning=!1,this.flagsCounter=this.difficulty.mines,this.cellsToOpenAmount=0,this.cellsOpenedCounter=0}getCell=cellKey=>{if(this._checkCell(cellKey))return this.state[cellKey.x][cellKey.y]};_checkCell=cellKey=>void 0!==this.state[cellKey.x]&&void 0!==this.state[cellKey.x][cellKey.y];flagCell=cellKey=>{const cell=this.getCell(cellKey);return cell.isOpened||(cell.isFlagged?(this.flagsCounter+=1,cell.state=Cell.STATE_CLOSED):(this.flagsCounter-=1,cell.state=Cell.STATE_FLAGGED)),this.flagsCounter};openCell=cellKey=>{const cell=this.getCell(cellKey);if(!(cell.isFlagged||cell.isOpened&&(cell.isMined||cell.isEmpty)))if(cell.isOpened&&cell.isNumber){const cells=this.getHighlightedCells(cellKey);if(0===cells.length||cell.value>this.countFlagsAround(cellKey))return;cells.forEach(this.openCell)}else cell.state=Cell.STATE_OPENED,cell.isEmpty&&this._revealEmptySpace(cellKey)};reveal=cellKey=>{this.isGameRunning||(this.isGameRunning=!0,this.generateState(cellKey),this.emit("gamestart")),this.openCell(cellKey)};openAll=()=>{for(let rowIdx=0;rowIdx<this.state.length;rowIdx+=1)for(let colIdx=0;colIdx<this.state[rowIdx].length;colIdx+=1){const cellKey=new CellKey(rowIdx,colIdx),cell=this.getCell(cellKey);!cell.isFlagged&&cell.isClosed&&(cell.state=Cell.STATE_OPENED)}};handleCellOpen=cell=>{this.isGameRunning&&(this.cellsOpenedCounter+=1,this.cellsOpenedCounter===this.cellsToOpenAmount&&(this.isGameRunning=!1,this.openAll(),this.emit("win")))};handleLose=cell=>{this.isGameRunning&&(this.isGameRunning=!1,this.openAll(),this.emit("lose",{mineKey:cell.key,wrongFlagsKeys:this._findWrongFlags()}))};countFlagsAround=cellKey=>Object.values(checks).reduce(((counter,[dx,dy])=>{const newCellKey=new CellKey(cellKey.x+dx,cellKey.y+dy),cell=this.getCell(newCellKey);return counter+(cell?cell.isFlagged:0)}),0);getHighlightedCells=cellKey=>Object.values(checks).reduce(((cells,[dx,dy])=>{const newCellKey=new CellKey(cellKey.x+dx,cellKey.y+dy),cell=this.getCell(newCellKey);return cell&&cell.isClosed&&cells.push(newCellKey),cells}),[]);generateState=cellKey=>{this._generateMines(cellKey),this._generateNumbers()};reset=newDifficulty=>{void 0!==newDifficulty&&(this.difficulty=newDifficulty),this.isGameRunning=!1,this.flagsCounter=this.difficulty.mines,this.cellsToOpenAmount=0,this.cellsOpenedCounter=0,this.state=this._generateInitialMatrix()};_findWrongFlags=()=>{const wrongFlagsKeys=[];for(let rowIdx=0;rowIdx<this.state.length;rowIdx+=1)for(let colIdx=0;colIdx<this.state[rowIdx].length;colIdx+=1){const cellKey=new CellKey(rowIdx,colIdx),cell=this.getCell(cellKey);cell.isFlagged&&!cell.isMined&&wrongFlagsKeys.push(cellKey)}return wrongFlagsKeys};_revealEmptySpace=startCellKey=>{const reveal=(key,startCellKey)=>{const[dx,dy]=checks[key],newCellKey=new CellKey(startCellKey.x+dx,startCellKey.y+dy),cell=this.getCell(newCellKey);!cell||cell.isOpened||cell.isFlagged||(cell.isNumber?cell.state=Cell.STATE_OPENED:cell.isEmpty&&(cell.state=Cell.STATE_OPENED,Object.keys(checks).forEach((checkKey=>reveal(checkKey,newCellKey)))))};Object.keys(checks).forEach((key=>reveal(key,startCellKey)))};_generateInitialMatrix=()=>{const{width,height}=this.difficulty,matrix=[];for(let rowIdx=0;rowIdx<height;rowIdx+=1){matrix.push(new Array(width).fill(null));for(let colIdx=0;colIdx<width;colIdx+=1){const cellKey=new CellKey(rowIdx,colIdx);matrix[rowIdx][colIdx]=new Cell(cellKey)}}return matrix};_generateMines=excludedCellKey=>{const{mines:minesNumber,width,height}=this.difficulty,mines={};for(let k=0;k<minesNumber;k+=1){let newCellKey;do{newCellKey=new CellKey(randomNumber(0,height),randomNumber(0,width))}while(mines[newCellKey.value]||newCellKey.value===excludedCellKey.value);mines[newCellKey.value]=1;const cell=this.getCell(newCellKey);cell.value=Cell.VALUE_MINE,cell.subscribe("mineopen",this.handleLose)}};_countNeighboringMines=cellKey=>Object.values(checks).reduce(((counter,[dx,dy])=>{const newCellKey=new CellKey(cellKey.x+dx,cellKey.y+dy),cell=this.getCell(newCellKey);return counter+(cell?cell.isMined:0)}),0);_generateNumbers=()=>{for(let rowIdx=0;rowIdx<this.state.length;rowIdx+=1)for(let colIdx=0;colIdx<this.state[rowIdx].length;colIdx+=1){const cellKey=new CellKey(rowIdx,colIdx),cell=this.getCell(cellKey);if(!cell.isMined){this.cellsToOpenAmount+=1;const value=this._countNeighboringMines(cellKey);cell.value=value,cell.subscribe("cellopen",this.handleCellOpen)}}}}(options.difficulty[currentDifficulty]);gameState.subscribe("win",(function handleWin(){gameTimer.stop(),resetBtn.classList.add("reset-btn_win"),gameField.handleWin();const statisticsData=createStatisticsData("win");showModal(statisticsData),updateStatistics(statisticsData)})),gameState.subscribe("lose",(function handleLose(data){gameTimer.stop(),resetBtn.classList.add("reset-btn_lose"),gameField.handleLose(data);const statisticsData=createStatisticsData("lose");showModal(statisticsData),updateStatistics(statisticsData)}));const gameContainer=document.querySelector(".game");gameContainer.insertAdjacentHTML("beforeend",game_top_panel_default()());const gameField=new class GameField{constructor(difficulty,gameState){this.difficulty=difficulty,this.gameState=gameState,this.cells={},this.highlightedCells=null,this.flagsCounter=document.querySelector(".game__flags-counter-value")}render=()=>this.gameField;_createCell=cellKey=>{const cell=document.createElement("td");return cell.classList.add(CELL_CLASS),cell.classList.add(CELL_MODIFICATORS.closed),cell.dataset.key=cellKey.value,cell.dataset.state=Cell.STATE_CLOSED,cell};_createTable=()=>{const{width,height}=this.difficulty,table=document.createElement("table");table.classList.add("game-field"),this.cells={};for(let rowIdx=0;rowIdx<height;rowIdx+=1){const row=document.createElement("tr");for(let colIdx=0;colIdx<width;colIdx+=1){const cellKey=new CellKey(rowIdx,colIdx),cellEl=this._createCell(cellKey);this.cells[cellKey]=cellEl,row.insertAdjacentElement("beforeend",cellEl)}table.insertAdjacentElement("beforeend",row)}return table};getCellModificator=value=>Cell.isNumberValue(value)?CELL_MODIFICATORS.number+value:value===Cell.VALUE_MINE?CELL_MODIFICATORS.mine:value===Cell.VALUE_EMPTY?CELL_MODIFICATORS.empty:void 0;applyState=()=>{Object.keys(this.cells).forEach((key=>{const cellKey=new CellKey(key),cell=this.gameState.getCell(cellKey),cellEl=this.cells[key],cellElState=+cellEl.dataset.state;cell.isOpened&&cellElState!==Cell.STATE_OPENED?(cellEl.dataset.state=Cell.STATE_OPENED,cellEl.classList.remove(CELL_MODIFICATORS.closed),cellEl.classList.add(this.getCellModificator(cell.value))):cell.isFlagged&&cellElState!==Cell.STATE_FLAGGED?(cellEl.dataset.state=Cell.STATE_FLAGGED,cellEl.classList.remove(CELL_MODIFICATORS.closed),cellEl.classList.add(CELL_MODIFICATORS.flagged)):cell.isClosed&&cellElState!==Cell.STATE_CLOSED&&(cellEl.dataset.state=Cell.STATE_CLOSED,cellEl.classList.remove(CELL_MODIFICATORS.flagged),cellEl.classList.add(CELL_MODIFICATORS.closed))}))};reset=newDifficulty=>{void 0!==newDifficulty&&(this.difficulty=newDifficulty),this.gameField=this._createTable(),this.gameField.addEventListener("mousedown",this.handleGameFieldMouseDown),this.gameField.addEventListener("mouseup",this.handleGameFieldMouseUp),this.gameField.addEventListener("contextmenu",this.handleGameFieldRightClick),this.flagsCounter.textContent=renderNumber(this.gameState.flagsCounter)};handleLose=({mineKey,wrongFlagsKeys})=>{setTimeout((()=>{wrongFlagsKeys.forEach((key=>{this.cells[key].classList.replace(CELL_MODIFICATORS.flagged,CELL_MODIFICATORS.wronglyFlagged)})),this.cells[mineKey.value].classList.replace(CELL_MODIFICATORS.mine,CELL_MODIFICATORS.mineBlowned)})),this.removeEventListeners()};handleWin=()=>{this.removeEventListeners()};removeEventListeners=()=>{this.gameField.removeEventListener("mousedown",this.handleGameFieldMouseDown),this.gameField.removeEventListener("mouseup",this.handleGameFieldMouseUp)};handleGameFieldMouseUp=e=>{const cellEl=e.target.closest(`.${CELL_CLASS}`);if(!cellEl)return;const cellKey=new CellKey(cellEl.dataset.key);if(e.button===MOUSE_LEFT&&this.gameState.reveal(cellKey),e.button===MOUSE_RIGHT){const flagsCounter=this.gameState.flagCell(cellKey);this.flagsCounter.textContent=renderNumber(flagsCounter)}this.applyState()};handleGameFieldRightClick=e=>{e.preventDefault()};handleDocumentMouseUp=e=>{null!==this.highlightedCells&&(this.highlightedCells.forEach((key=>this.cells[key.value].classList.remove(CELL_MODIFICATORS.highlighted))),this.highlightedCells=null,document.removeEventListener("mouseup",this.handleDocumentMouseUp))};handleGameFieldMouseDown=e=>{e.preventDefault();const cellEl=e.target.closest(`.${CELL_CLASS}`);if(cellEl){const cellKey=new CellKey(cellEl.dataset.key);if(0===e.button){const cell=this.gameState.getCell(cellKey);cell.isOpened&&cell.isNumber&&(this.highlightedCells=this.gameState.getHighlightedCells(cellKey),this.highlightedCells.forEach((key=>this.cells[key.value].classList.add(CELL_MODIFICATORS.highlighted))),document.addEventListener("mouseup",this.handleDocumentMouseUp))}}}}(options.difficulty[currentDifficulty],gameState),resetBtn=document.querySelector(".reset-btn"),gameTimerLabel=document.querySelector(".game__timer-value"),gameTimer=new class Timer extends Emitter{constructor(){super(),this.reset()}reset(){this.isRunning=!1,this.startTime=0,this.endTime=0,this.prevTime=0,this.secondsCounter=0,this._emitChange()}_emitChange(){this.emit("change",this.secondsCounter)}start=()=>{this.isRunning=!0,this.startTime=Date.now(),this.prevTime=this.startTime;const checkTime=()=>{if(this.isRunning){const currTime=Date.now();currTime-this.prevTime>=1e3&&(this.secondsCounter+=1,this.prevTime=currTime,this._emitChange()),requestAnimationFrame(checkTime)}};checkTime()};stop(){this.isRunning=!1,this.endTime=Date.now()}getGameTime(){return this.endTime-this.startTime}renderGameTime(){return renderTime(this.getGameTime())}};function index_resetGame(e,newDifficuty=currentDifficulty){currentDifficulty!==newDifficuty&&(currentDifficulty=newDifficuty);const difficulty=options.difficulty[newDifficuty];gameState.reset(difficulty),gameField.render()&&gameContainer.removeChild(gameField.render()),gameField.reset(difficulty),gameContainer.insertAdjacentElement("beforeend",gameField.render()),gameTimer.reset(),resetBtn.classList.remove("reset-btn_win","reset-btn_lose")}function createStatisticsData(result){return{result,difficulty:currentDifficulty,time:gameTimer.getGameTime()}}gameTimer.subscribe("change",(function updateTimerLabel(time){gameTimerLabel.textContent=renderNumber(time)})),gameState.subscribe("gamestart",gameTimer.start),resetBtn.addEventListener("click",index_resetGame),index_resetGame(),function menu_tabs_init(){document.querySelector(".header").addEventListener("click",handleMenuBtnClick)}(),function statistics_init(){statisticsTab.addEventListener("click",handleStatisticsTabClick)}(),console.log(requirements)})()})();
//# sourceMappingURL=main-6a482945.js.map